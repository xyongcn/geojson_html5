<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, user-scalable=no">
	<title>Maps &ndash; Wanli Yang</title>
	<link rel="stylesheet" href="geojson_html5-master/stylesheets/maps.css" />
</head>
<body>
	<h1 align="left">  VIMAP - Vector and Image Map</h1>

	

	<div id="map">
		<button id="zoom-out">缩小</button>
	    <button id="zoom-in">放大</button>
		<button id="vector map">矢量地图</button>
		<select name="image source" id="image source">
		  <option value="http://a.tile.openstreetmap.org/">OpenStreetMap</option>
		  <option value="http://tile.opencyclemap.org/cycle/">OpenCycleMap</option>
		  <option value="http://p3.map.gtimg.com/maptilesv2/">TencentMap</option>
		  <option value="http://mt2.google.cn/vt/lyrs=m@258000000">GoogleMap</option>
		</select>
	    <button id="img map">图像地图</button>
		<select name="select hour" id="select hour">
		  <option value="0">0点</option>
		  <option value="1">1点</option>
		  <option value="2">2点</option>
		  <option value="3">3点</option>
		  <option value="4">4点</option>
		  <option value="5">5点</option>
		  <option value="6">6点</option>
		  <option value="7">7点</option>
		  <option value="8">8点</option>
		  <option value="9">9点</option>
		  <option value="10">10点</option>
		  <option value="11">11点</option>
		  <option value="12">12点</option>
		  <option value="13">13点</option>
		  <option value="14">14点</option>
		  <option value="15">15点</option>
		  <option value="16">16点</option>
		  <option value="17">17点</option>
		  <option value="18">18点</option>
		  <option value="19">19点</option>
		  <option value="20">20点</option>
		  <option value="21">21点</option>
		  <option value="22">22点</option>
		  <option value="23">23点</option>
		</select>
		<select name="select minute" id="select minute">
		  <option value="0">0-14分</option>
		  <option value="1">15-29分</option>
		  <option value="2">30-44分</option>
		  <option value="3">45-59分</option>
		</select>
	    <button id="road map">显示路况</button>    
	</div>

	<script src="geojson_html5-master/javascript/storage.js"></script>
	<script src="geojson_html5-master/javascript/jquery.js"></script>
	<script src="geojson_html5-master/javascript/vimap.js"></script>
	<script src="geojson_html5-master/javascript/wgs2mars.js"></script>
	<script src="geojson_html5-master/stylesheets/ways.js"></script>
	<script src="geojson_html5-master/stylesheets/water.js"></script>
	<script src="geojson_html5-master/stylesheets/waterway.js"></script>
	<script src="geojson_html5-master/stylesheets/building.js"></script>
	<script src="geojson_html5-master/stylesheets/railway.js"></script>
	<script src="geojson_html5-master/stylesheets/landcover.js"></script>
	<script>
//116.1520161816  39.71115201618162  116.3912  39.9059
		//中心点的经纬度坐标及缩放等级
		var lon = 116.3912;    //经度116.4161
		var lat = 39.9059; //纬度39.9165
		var zoom = 15;               //缩放等级
		
		function lon2tile(lon,zoom) { //经度转切片坐标x函数
			return (Math.floor((lon + 180) / 360 * Math.pow(2, zoom)));
		};
		function lat2tile(lat,zoom) { //纬度转切片坐标y函数 
			return (Math.floor((1 - Math.log(Math.tan(lat * Math.PI / 180) + 1 / Math.cos(lat * Math.PI / 180)) / Math.PI) / 2 * Math.pow(2, zoom)));
		};

		var x = lon2tile(lon,zoom); //中心切片的x值
		var y = lat2tile(lat,zoom); //中心切片的y值

		var flag =1;  //地图数据源的信号函数 初始化为0；
		var road_flag=0; //路网触发信号
		var changeCenter=1; //中心位置切片修正触发信号
		var roadCondition_flag=0;//路况触发信号
		var countFlag=0;
		var roadConditionTime = 1; //路况时间参数
		var selectImageFlag = 0;
	 
		//鼠标事件位移量初始化
		var eventX=0; 
		var eventY=0;

		// URL - 对应服务器
		var url1 ="http://166.111.68.197:11193/geoserver/";
		//var url1="http://10.108.21.66/geoserver/"

		var url2 ="http://166.111.68.197:11193/geoserver/i/";
		//http://166.111.68.197:11193/geoserver/i/12/3377/1555

		var url3 ="http://otile2.mqcdn.com/tiles/1.0.0/osm/";

		var imageURL = "http://a.tile.openstreetmap.org/";

		var url4 = "http://a.tile.openstreetmap.org/";
		//http://otile2.mqcdn.com/tiles/1.0.0/osm/12/3377/1555.png

		var url5 = "http://tile.opencyclemap.org/cycle/";

		var url6 ="http://p3.map.gtimg.com/maptilesv2/";

		var url7 = "http://mt2.google.cn/vt/lyrs=m@258000000&hl=zh-CN&gl=CN&src=app&" //x=13478&y=6218&z=14&s=Ga
		//http://p3.map.gtimg.com/maptilesv2/z/a/b/x_YTencent.png，其中TMS 与Google 坐标系的x，z是相等的，Y的转换关系为：Y(TMS) +  Y(Google) = 2z – 1。所以，YTencent=2z – 1– y，a= Math.Floor(x/16.0) ，b=Math.Floor(YTencent /16.0)。
		//var imageURL ="http://tile.opencyclemap.org/cycle/";


		var store = new Array(); //切片块缓存


		var roadCondition = new Array();
		var roadConditionStorageFlag=0;

		var map = new Map(document.getElementById("map"),zoom,x,y);
		
		var bbox = new Array;     //切片边界数组
		var right=0;
		var left=0;
		var up=0;
		var down=0;
		map.draw_Image(zoom,x,y); //绘制地图

	</script>
</body>
</html>